{% extends "layout.html" %}

{% block title %}{{ collection.title }}{% endblock %}

{% block content %}
    <!-- Header and Controls -->
    <div class="mb-8">
        <h1 class="text-4xl font-bold text-white mb-4">{{ collection.title }}</h1>
        <div class="flex flex-wrap gap-4">
            <!-- Play Collection -->
            <form method="POST" action="{{ url_for('play_collection_route', collection_title=collection.title) }}">
                <button type="submit" class="p-2 px-6 bg-green-600 rounded-lg font-semibold text-white hover:bg-green-700 transition-colors">
                    Play All
                </button>
            </form>
            
            <!-- Rename Collection -->
            <form method="POST" action="{{ url_for('rename_collection') }}" class="flex gap-2">
                <input type="hidden" name="old_title" value="{{ collection.title }}">
                <input type="text" name="new_title" placeholder="New name" required
                       class="p-2 bg-gray-600 rounded-lg text-white border border-gray-500 focus:outline-none focus:ring-2 focus:ring-blue-500">
                <button type="submit" class="p-2 px-4 bg-yellow-600 rounded-lg font-semibold text-white hover:bg-yellow-700 transition-colors">
                    Rename
                </button>
            </form>
            
            <!-- Delete Collection -->
            <form method="POST" action="{{ url_for('delete_collection') }}">
                <input type="hidden" name="title" value="{{ collection.title }}">
                <button type="submit" onclick="return confirm('Are you sure you want to delete this entire collection?');"
                        class="p-2 px-4 bg-red-600 rounded-lg font-semibold text-white hover:bg-red-700 transition-colors">
                    Delete Collection
                </button>
            </form>
        </div>
    </div>

    <!-- Song List in Collection -->
    {% if collection.songs %}
        <div class="overflow-x-auto">
            <table class="w-full min-w-[1000px] text-left table-auto">
                <thead class="bg-gray-700">
                    <tr class="text-gray-300 uppercase text-sm">
                        <th class="p-4">Song</th>
                        <th class="p-4">Artist</th>
                        <th class="p-4">Album</th>
                        <th class="p-4">Genre</th>
                        <th class="p-4">Length</th>
                        <th class="p-4">Your Rating</th>
                        <th class="p-4">Actions</th>
                    </tr>
                </thead>
                <tbody class="divide-y divide-gray-700">
                    {% for song in collection.songs %}
                    <tr class="hover:bg-gray-700/50">
                        <td class="p-4 font-medium text-white">{{ song.songtitle }}</td>
                        <td class="p-4 font-medium text-white">{{ song.artist_list }}</td>
                        <td class="p-4 font-medium text-white">{{ song.albumtitle }}</td>
                        <td class="p-4 font-medium text-white">{{ song.genre_list  or 'Unkmowm'}}</td>
                        <td class="p-4 font-medium text-white">{{ "%.2f"|format(song.length / 60) }} min</td>
                        <td class="p-4">
                            {% if song.rating %}
                                <span class="text-yellow-400">{{ song.rating }} Star{% if song.rating > 1 %}s{% endif %}</span>
                            {% else %}
                                <span class="text-gray-400">Not Rated</span>
                            {% endif %}
                        </td>
                        <td class="p-4 space-y-3">
                            <!-- Play Song -->
                            <form method="POST" action="{{ url_for('play_song_route', song_id=song.songid) }}">
                                <button type="submit" class="w-full text-center px-3 py-1.5 text-sm bg-green-600 text-white rounded-md hover:bg-green-700 transition-colors">Play</button>
                            </form>
                            <!-- Remove Song -->
                            <form method="POST" action="{{ url_for('remove_song_from_collection') }}">
                                <input type="hidden" name="collection_title" value="{{ collection.title }}">
                                <input type="hidden" name="song_id" value="{{ song.songid }}">
                                <button type="submit" class="w-full text-center px-3 py-1.5 text-sm bg-red-600 text-white rounded-md hover:bg-red-700 transition-colors">Remove</button>
                            </form>
                            <!-- Rate Song -->
                            <form method="POST" action="{{ url_for('rate_song_route') }}" class="flex gap-2">
                                <input type="hidden" name="song_id" value="{{ song.songid }}">
                                <select name="rating" class="w-full p-1.5 text-sm bg-gray-600 rounded-md text-white border border-gray-500 focus:outline-none focus:ring-1 focus:ring-blue-500">
                                    <option value="" disabled {% if not song.rating %}selected{% endif %}>Rate...</option>
                                    <option value="1" {% if song.rating == 1 %}selected{% endif %}>1 Star</option>
                                    <option value="2" {% if song.rating == 2 %}selected{% endif %}>2 Stars</option>
                                    <option value="3" {% if song.rating == 3 %}selected{% endif %}>3 Stars</option>
                                    <option value="4" {% if song.rating == 4 %}selected{% endif %}>4 Stars</option>
                                    <option value="5" {% if song.rating == 5 %}selected{% endif %}>5 Stars</option>
                                </select>
                                <button type="submit" class="px-3 py-1.5 text-sm bg-yellow-600 text-white rounded-md hover:bg-yellow-700 transition-colors">OK</button>
                            </form>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    {% else %}
        <div class="p-6 bg-gray-700 rounded-xl text-center">
            <p class="text-lg text-gray-300">This collection is empty.</p>
            <p class="text-gray-400">Go to the <a href="{{ url_for('search') }}" class="text-blue-400 hover:underline">Search</a> page to add songs.</p>
        </div>
    {% endif %}
{% endblock %}